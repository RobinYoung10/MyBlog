---
title: MySQL学习笔记（一）
date: 2019-04-27 18:16:48
tags: MySQL
---

### 一、连接查询

连接查询可以实现多个表查询，当查询数据时，通过连接操作查询出存放在多个表中的不同实体信息。

##### 1.内连接查询

内连接查询（INNER JOIN）使用比较运算符进行表间某些列数据的比较操作，并列出这些表中与连接条件相匹配的数据行，组合成新纪录。有两个表`tb_sjxx`和`tb_cpxx`，表结构如下：

```
mysql> desc tb_sjxx;
+-------+-------------+------+-----+---------+-------+
| Field | Type        | Null | Key | Default | Extra |
+-------+-------------+------+-----+---------+-------+
| sjbh  | varchar(20) | NO   | PRI | NULL    |       |
| zh    | varchar(20) | NO   |     | NULL    |       |
| mm    | varchar(20) | NO   |     | NULL    |       |
| sjmc  | varchar(20) | YES  |     | NULL    |       |
| dh    | varchar(20) | YES  |     | NULL    |       |
| yysj  | varchar(20) | YES  |     | NULL    |       |
| ctjj  | varchar(50) | YES  |     | NULL    |       |
+-------+-------------+------+-----+---------+-------+
```

```
mysql> desc tb_cpxx;
+-------+--------------+------+-----+---------+-------+
| Field | Type         | Null | Key | Default | Extra |
+-------+--------------+------+-----+---------+-------+
| sjbh  | varchar(20)  | NO   |     | NULL    |       |
| cpbh  | varchar(30)  | NO   | PRI | NULL    |       |
| lx    | int(11)      | YES  |     | NULL    |       |
| mc    | varchar(20)  | YES  |     | NULL    |       |
| ms    | varchar(50)  | YES  |     | NULL    |       |
| tp    | varchar(200) | YES  |     | NULL    |       |
| jg    | double       | YES  |     | NULL    |       |
| ls    | varchar(30)  | YES  |     | NULL    |       |
+-------+--------------+------+-----+---------+-------+
```

两个表有相同数据类型的字段sjbh，通过这个字段建立联系，我们输入如下内连接查询语句，on后面就是查询的条件：

```sql
select tb_sjxx.sjbh, tb_sjxx.sjmc, tb_cpxx.mc from tb_sjxx inner join tb_cpxx on tb_sjxx.sjbh = tb_cpxx.sjbh;
```

查询结果如下：

```
+---------------+-------------------+--------------------------+
| sjbh          | sjmc              | mc                       |
+---------------+-------------------+--------------------------+
| sj20190302001 | 商家1             | 给很方便v你现场          |
| sj20190302001 | 商家1             | 二当时法国二万人         |
| sj20190302001 | 商家1             | 去微软222                |
| sj20190302001 | 商家1             | 的发生士大夫             |
| sj20190305001 | 26服务器测试      | 烧烤类                   |
| sj20190305001 | 26服务器测试      | 粉类                     |
| sj20190305001 | 26服务器测试      | 粥类                     |
```

##### 2.外连接查询

内连接时，返回的查询结果仅仅只是符合查询条件和连接条件的行。但是有的时候需要包含没有关联的行中数据，即返回查询结果集合中不仅包含符合连接条件的行，而且还包括左表（左连接）、右表（右连接）或两个连接表（全外连接）中的所有数据行。

* 左连接：返回包括左表中的所有记录和右表中连接字段相等的记录。
* 右连接：返回包括右表中的所有记录和左表中连接字段相等的记录。

###### 左连接

左连接的结果包括LEFT OUTER子句中指定的左表的所有行，而不仅仅是连接列所匹配的行。如果左表的某行在右表中没有匹配行，则在相关联的结果行中，右表的所有选择列表列均为空值。

输入如下左连接查询语句：

```sql
select tb_sjxx.sjbh, tb_cpxx.mc from tb_sjxx left outer join tb_cpxx on tb_sjxx.sjbh = tb_cpxx.sjbh;
```

结果如下：

```
+---------------+--------------------------+
| sjbh          | mc                       |
+---------------+--------------------------+
| sj20190302001 | sda撒地方                |
| sj20190302001 | 体育体育                 |
| sj20190302001 | 二二                     |
| sj20190302001 | 的发生士大夫             |
| sj20190302001 | 规范化                   |
| sj20190324001 | 苹果                     |
| sj20190324001 | 大白菜                   |
| sj20190324001 | 红牛                     |
| sj20190302002 | NULL                     |
| sj20190302003 | NULL                     |
| sj20190302004 | NULL                     |
| sj20190302005 | NULL                     |
| sj20190423001 | NULL                     |
+---------------+--------------------------+
```

可以看到，左连接语句里的左表tb_sjxx里所有的sjbh数据都查询出来了，而tb_cpxx里不一定全部都有对应的数据，所以出现了mc为NULL的数据。

###### 右连接

右连接就是左连接的反向连接，返回右表的所有行。如下：

```sql
select tb_cpxx.mc, tb_sjxx.sjbh from tb_cpxx right outer join tb_sjxx on tb_sjxx.sjbh = tb_cpxx.sjbh;
```

我们将查询的表和数据顺序都调换了一下，结果和上面差不多：

```
+--------------------------+---------------+
| mc                       | sjbh          |
+--------------------------+---------------+
| sda撒地方                | sj20190302001 |
| 体育体育                 | sj20190302001 |
| 二二                     | sj20190302001 |
| 的发生士大夫             | sj20190302001 |
| 规范化                   | sj20190302001 |
| 苹果                     | sj20190324001 |
| 大白菜                   | sj20190324001 |
| 红牛                     | sj20190324001 |
| NULL                     | sj20190302002 |
| NULL                     | sj20190302003 |
| NULL                     | sj20190302004 |
| NULL                     | sj20190302005 |
| NULL                     | sj20190423001 |
+--------------------------+---------------+
```